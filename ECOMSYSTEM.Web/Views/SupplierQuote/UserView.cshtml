@model IEnumerable<ECOMSYSTEM.Shared.Models.SupplierQuoteDetails>
@{
    Layout = "_Layout";
}

<!DOCTYPE html>
<html lang="en">
<head>
      @*      <script src="~/js/supplierQuotes.js"></script>*@    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotation List</title>
</head>
  <body>
        <div class="container mt-4">
            <div class="row mb-3">
                <div class="col-md-12">
                    <h1 class="mb-3">Quotation List</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Quotation List</li>
                        </ol>
                    </nav>
                </div>
            </div>

              <div class="col-lg-12">
                        <div class="row">
                            @if (Model != null && Model.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th scope="col">Item Name</th>
                                                <th scope ="col">Description</th>
                                                <th scope ="col">Supplier</th>
                                                <th scope="col">Mobile</th>
                                                <th scope="col">Quotation Amount</th>
                                                <th scope="col">Date</th>
                                                <th scope="col">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var quote in Model)
                                            {
                                                <tr>
                                                    <td>@Html.DisplayFor(modelItem => quote.ItemName)</td>
                                                    <td>@Html.DisplayFor(modelItem => quote.ItemDescription)</td>
                                                    <td>@Html.DisplayFor(modelItem => quote.UserName)</td>
                                                    <td>@Html.DisplayFor(modelItem => quote.MobileNo)</td>
                                                    <td>@Html.DisplayFor(modelItem => quote.QuotationAmount)</td>
                                                    <td>@Html.DisplayFor(modelItem => quote.CreatedDate)</td>
                                                    <td>
                                                        <button class="btn btn-primary"
                                                                type="button"
                                                                data-toggle="modal"
                                                                data-target="#verifyModalContent"
                                                        onclick="populateModal('@quote.SupplierQuoteId');">
                                                            Accept
                                                        </button>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>

                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="alert alert-warning" role="alert">
                                    No quotations are available for display.
                                </div>
                            }
                        </div>
                    </div>
            </div>

                <!-- Verify Modal Content -->
                <div class="modal fade bd-example-modal-lg" id="verifyModalContent" tabindex="-1" role="dialog" aria-labelledby="verifyModalContent" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title"
                                id="verifyModalContent_title"
                        style="font-family: 'Arial, sans-serif'; font-size: 1.5rem; font-weight: bold; text-align: center; color: #301934; margin-bottom: 15px;">
                                Almost there! Just share your details to seal the deal!
                            </h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">×</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <label class="col-form-label" for="recipient-name-2">Name:</label>
                                        <input class="form-control" id="name" type="text" />
                                    </div>
                                    <div class="form-group">
                                        <label class="col-form-label" for="recipient-name-2">Email:</label>
                                        <input class="form-control" id="email" type="text" />
                                    </div>
                                    <div class="form-group">
                                        <label class="col-form-label" for="recipient-name-2">Mobile:</label>
                                        <input class="form-control" id="mobile" type="text" />
                                    </div>
                                    <div class="form-group">
                                        <label class="col-form-label" for="recipient-name-2">Address:</label>
                                        <input class="form-control" id="address" type="text" />
                                    </div>

                                    <!-- Payment Section -->
                                    <hr />
                                    <h6>Payment Options</h6>
                                    <div class="form-group">
@*                                         <label>Accepted Cards:</label>
 *@                                        <div>
                                            <img src="../../dist-assets/images/visa.png" alt="Visa" style="width: 40px; margin-right: 10px;" />
                                            <img src="../../dist-assets/images/master-card.png" alt="MasterCard" style="width: 40px; margin-right: 10px;" />
                                            <img src="../../dist-assets/images/amex.png" alt="American Express" style="width: 40px;" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-form-label" for="card-name">Cardholder Name:</label>
                                        <input class="form-control" id="card-name" type="text" required />
                                    </div>
                                    <div class="form-group">
                                        <label class="col-form-label" for="card-number">Card Number:</label>
                                        <input class="form-control" id="card-number" type="text" maxlength="19" required placeholder="1234 5678 9012 3456" />
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label class="col-form-label" for="card-expiry">Expiry Date:</label>
                                            <input class="form-control" id="card-expiry" type="text" maxlength="5" placeholder="MM/YY" required />
                                            <small id="expiry-error" style="color: red; display: none;">Invalid or expired date</small>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label class="col-form-label" for="card-cvv">CVV:</label>
                                            <input class="form-control" id="card-cvv" type="password" maxlength="3" placeholder="123" required />
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
                                <button class="btn btn-primary" type="button">Pay</button>
                            </div>
                        </div>
                    </div>
                </div>



   </body>
</html>


<script>
    document.getElementById("card-number").addEventListener("input", function (e) {
        // Remove all spaces
        let input = e.target.value.replace(/\s+/g, "");

        // Insert a space every 4 characters
        input = input.replace(/(\d{4})/g, "$1 ").trim();

        // Update the input value
        e.target.value = input;
    });

    document.getElementById("card-expiry").addEventListener("input", function (e) {
        const input = e.target;
        const value = input.value.replace(/[^0-9]/g, ""); // Allow only numbers
        let formattedValue = "";

        // Format as MM/YY
        if (value.length >= 3) {
            formattedValue = value.substring(0, 2) + "/" + value.substring(2, 4);
        } else {
            formattedValue = value;
        }

        input.value = formattedValue;

        validateExpiry(formattedValue);
    });

    function validateExpiry(value) {
        const error = document.getElementById("expiry-error");
        const currentDate = new Date();
        const currentMonth = currentDate.getMonth() + 1; // JavaScript months are 0-indexed
        const currentYear = currentDate.getFullYear() % 100; // Last two digits of the year

        if (value.length === 5) {
            const [month, year] = value.split("/").map(Number);

            if (
                month < 1 ||
                month > 12 ||
                year < currentYear ||
                (year === currentYear && month < currentMonth)
            ) {
                // Show error for invalid or expired date
                error.style.display = "block";
                document.getElementById("card-expiry").classList.add("is-invalid");
            } else {
                // Valid date
                error.style.display = "none";
                document.getElementById("card-expiry").classList.remove("is-invalid");
            }
        } else {
            // Invalid format or incomplete input
            error.style.display = "block";
            document.getElementById("card-expiry").classList.add("is-invalid");
        }
    }

</script>

 @* <script>
     function updateQuotationStatus(quotationId, status) {
         Swal.fire({
             title: 'Are you sure?',
             text: `Do you want to ${status.toLowerCase()} this quotation?`,
             icon: 'warning',
             showCancelButton: true,
             confirmButtonColor: status === 'Accepted' ? '#28a745' : '#dc3545',
             cancelButtonColor: '#6c757d',
             confirmButtonText: 'Yes, proceed!'
         }).then((result) => {
             if (result.isConfirmed) {
                 $.ajax({
                     url: '/Quotation/UpdateStatus',
                     type: 'POST',
                     data: {
                         quotationId: quotationId,
                         status: status
                     },
                     success: function (response) {
                         if (response.success) {
                             Swal.fire(
                                 'Updated!',
                                 `Quotation has been ${status.toLowerCase()}.`,
                                 'success'
                             ).then(() => {
                                 location.reload();
                             });
                         } else {
                             Swal.fire(
                                 'Error!',
                                 'Something went wrong.',
                                 'error'
                             );
                         }
                     },
                     error: function () {
                         Swal.fire(
                             'Error!',
                             'Failed to update quotation status.',
                             'error'
                         );
                     }
                 });
             }
         });
     }
 </script> *@